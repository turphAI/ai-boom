"use strict";(()=>{var a={};a.id=383,a.ids=[383],a.modules={3873:a=>{a.exports=require("path")},4838:(a,b,c)=>{c.d(b,{a:()=>f});var d=c(9010);class e{async evaluateAlerts(){try{let a=await d.K.getLatestMetrics(),b=[];for(let c of a)for(let a of this.thresholds.filter(a=>a.metricKey===c.id&&a.enabled))if(this.evaluateThreshold(c,a)){let d={id:`${a.id}_${Date.now()}`,thresholdId:a.id,metricKey:c.id,currentValue:c.value,thresholdValue:a.thresholdValue,severity:a.severity,message:this.generateAlertMessage(c,a),timestamp:new Date().toISOString(),triggered:!0};b.push(d)}return b}catch(a){return console.error("Error evaluating alerts:",a),[]}}evaluateThreshold(a,b){let{value:c}=a,{thresholdValue:d,comparisonOperator:e}=b;switch(e){case"gt":return c>d;case"lt":return c<d;case"gte":return c>=d;case"lte":return c<=d;case"eq":return c===d;default:return!1}}generateAlertMessage(a,b){let{name:c,value:d,unit:e,changePercent:f}=a,{thresholdValue:g,severity:h,description:i}=b,j=(a,b)=>"currency"===b?`$${(a/1e9).toFixed(1)}B`:"percent"===b?`${(100*a).toFixed(1)}%`:a.toLocaleString(),k=j(d,e),l=j(g,e),m=0!==f?` (${f>0?"+":""}${f.toFixed(1)}% from previous)`:"";return`ðŸš¨ ${h.toUpperCase()} ALERT: ${c}${m}

Current: ${k}
Threshold: ${l}
Status: ${i}

Time: ${new Date().toLocaleString()}`}async getThresholds(){return this.thresholds}async updateThreshold(a){let b=this.thresholds.findIndex(b=>b.id===a.id);-1!==b?this.thresholds[b]=a:this.thresholds.push(a)}async deleteThreshold(a){this.thresholds=this.thresholds.filter(b=>b.id!==a)}constructor(){this.thresholds=[{id:"bond_issuance_warning",metricKey:"bond_issuance",thresholdType:"absolute",thresholdValue:4e9,comparisonOperator:"gte",severity:"medium",enabled:!0,description:"Bond issuance exceeds $4B warning threshold"},{id:"bond_issuance_critical",metricKey:"bond_issuance",thresholdType:"absolute",thresholdValue:5e9,comparisonOperator:"gte",severity:"critical",enabled:!0,description:"Bond issuance exceeds $5B critical threshold"},{id:"bdc_discount_warning",metricKey:"bdc_discount",thresholdType:"absolute",thresholdValue:8,comparisonOperator:"gte",severity:"medium",enabled:!0,description:"BDC discount exceeds 8% warning threshold"},{id:"bdc_discount_critical",metricKey:"bdc_discount",thresholdType:"absolute",thresholdValue:10,comparisonOperator:"gte",severity:"critical",enabled:!0,description:"BDC discount exceeds 10% critical threshold"},{id:"credit_fund_warning",metricKey:"credit_fund",thresholdType:"absolute",thresholdValue:8e10,comparisonOperator:"gte",severity:"medium",enabled:!0,description:"Credit fund assets exceed $80B warning threshold"},{id:"credit_fund_critical",metricKey:"credit_fund",thresholdType:"absolute",thresholdValue:1e11,comparisonOperator:"gte",severity:"critical",enabled:!0,description:"Credit fund assets exceed $100B critical threshold"},{id:"bank_provision_warning",metricKey:"bank_provision",thresholdType:"absolute",thresholdValue:12,comparisonOperator:"gte",severity:"medium",enabled:!0,description:"Bank provisions exceed 12% warning threshold"},{id:"bank_provision_critical",metricKey:"bank_provision",thresholdType:"absolute",thresholdValue:15,comparisonOperator:"gte",severity:"critical",enabled:!0,description:"Bank provisions exceed 15% critical threshold"}]}}let f=new e},5600:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6935:(a,b,c)=>{c.r(b),c.d(b,{config:()=>o,default:()=>n,handler:()=>q});var d={};c.r(d),c.d(d,{default:()=>k});var e=c(9046),f=c(8667),g=c(3480),h=c(6435),i=c(4838);let j=[{id:"1",type:"threshold_breach",dataSource:"bond_issuance",metricName:"Bond Issuance",message:"Weekly bond issuance exceeded $5B threshold",severity:"high",timestamp:new Date(Date.now()-72e5).toISOString(),acknowledged:!1},{id:"2",type:"threshold_breach",dataSource:"credit_fund",metricName:"Credit Fund Assets",message:"Credit fund assets dropped 15% from previous quarter",severity:"critical",timestamp:new Date(Date.now()-216e5).toISOString(),acknowledged:!0},{id:"3",type:"data_staleness",dataSource:"bdc_discount",metricName:"BDC Discount",message:"BDC discount data is 48 hours old",severity:"medium",timestamp:new Date(Date.now()-864e5).toISOString(),acknowledged:!1}];async function k(a,b){if("GET"===a.method)try{let a=(await i.a.evaluateAlerts()).map(a=>({id:a.id,type:"threshold_breach",dataSource:a.metricKey,metricName:a.metricKey.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()),message:a.message,severity:a.severity,timestamp:a.timestamp,acknowledged:!1})),c=[...a,...j];b.status(200).json({success:!0,alerts:c,timestamp:new Date().toISOString(),note:a.length>0?"Includes real-time triggered alerts":"Using mock data only"})}catch(a){console.error("Error fetching alert history:",a),b.status(500).json({success:!1,message:"Failed to fetch alert history",alerts:[]})}else if("PUT"===a.method)try{let{id:c}=a.body;console.log(`Acknowledging alert: ${c}`),b.status(200).json({success:!0,message:"Alert acknowledged"})}catch(a){console.error("Error acknowledging alert:",a),b.status(500).json({success:!1,message:"Failed to acknowledge alert"})}else if("DELETE"===a.method)try{let{id:c}=a.query;console.log(`Dismissing alert: ${c}`),b.status(200).json({success:!0,message:"Alert dismissed"})}catch(a){console.error("Error dismissing alert:",a),b.status(500).json({success:!1,message:"Failed to dismiss alert"})}else b.status(405).json({message:"Method not allowed"})}var l=c(8112),m=c(8766);let n=(0,h.M)(d,"default"),o=(0,h.M)(d,"config"),p=new g.PagesAPIRouteModule({definition:{kind:f.A.PAGES_API,page:"/api/alerts/history",pathname:"/api/alerts/history",bundlePath:"",filename:""},userland:d,distDir:".next",projectDir:""});async function q(a,b,c){let d=await p.prepare(a,b,{srcPage:"/api/alerts/history"});if(!d){b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve());return}let{query:f,params:g,prerenderManifest:h}=d;try{let c=a.method||"GET",d=(0,l.getTracer)(),e=d.getActiveScopeSpan(),i=p.instrumentationOnRequestError.bind(p),j=async e=>p.render(a,b,{query:{...f,...g},params:g,allowedRevalidateHeaderKeys:void 0,multiZoneDraftMode:!0,trustHostHeader:void 0,previewProps:h.preview,propagateError:!1,dev:p.isDev,page:"/api/alerts/history",projectDir:"",onError:(...b)=>i(a,...b)}).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let f=d.getRootSpanAttributes();if(!f)return;if(f.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${f.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let g=f.get("next.route");if(g){let a=`${c} ${g}`;e.setAttributes({"next.route":g,"http.route":g,"next.span_name":a}),e.updateName(a)}else e.updateName(`${c} ${a.url}`)});e?await j(e):await d.withPropagatedContext(a.headers,()=>d.trace(m.BaseServerSpan.handleRequest,{spanName:`${c} ${a.url}`,kind:l.SpanKind.SERVER,attributes:{"http.method":c,"http.target":a.url}},j))}catch(a){if(p.isDev)throw a;(0,e.sendError)(b,500,"Internal Server Error")}finally{null==c.waitUntil||c.waitUntil.call(c,Promise.resolve())}}},9010:(a,b,c)=>{c.d(b,{K:()=>i});var d=c(9021),e=c.n(d),f=c(3873),g=c.n(f);class h{async getLatestMetrics(){try{let a=await this.getDataFiles(),b=[];for(let c of a){let a=await this.readDataFile(c);if(a.length>0){let c=a[0],d=this.getMetricKey(c.data_source,c.metric_name),e=0,f=0;if(a.length>1){let b=a[1];e=c.data.value-b.data.value,f=0!==b.data.value?e/b.data.value*100:0}let g=this.getStatus(c.data.value,d),h={key:d,name:this.formatMetricName(c.data_source,c.metric_name),value:c.data.value,unit:this.getUnit(d),change:e,changePercent:f,status:g,lastUpdated:c.timestamp,source:c.data_source,confidence:c.data.confidence,metadata:c.data.metadata};b.push(h)}}return b}catch(a){return console.error("Error reading real data:",a),[]}}async getHistoricalData(a,b){try{let c=await this.getDataFiles(),d=new Date;for(let e of(d.setDate(d.getDate()-b),c)){let b=await this.readDataFile(e);if(b.length>0&&this.getMetricKey(b[0].data_source,b[0].metric_name)===a)return b.filter(a=>new Date(a.timestamp)>=d).map(a=>({timestamp:a.timestamp,value:a.data.value,metadata:a.data.metadata})).sort((a,b)=>new Date(a.timestamp).getTime()-new Date(b.timestamp).getTime())}return[]}catch(a){return console.error("Error reading historical data:",a),[]}}async getDataSources(){try{let a=await this.getDataFiles(),b=new Set;for(let c of a){let a=await this.readDataFile(c);a.length>0&&b.add(a[0].data_source)}return Array.from(b)}catch(a){return console.error("Error reading data sources:",a),[]}}async getDataFiles(){try{return(await e().promises.readdir(this.dataDir)).filter(a=>a.endsWith(".json")).filter(a=>!a.includes("dashboard_alerts")).filter(a=>!a.includes("test_")).filter(a=>!a.includes("health_check_")).filter(a=>!a.includes("comprehensive_test_")).map(a=>g().join(this.dataDir,a))}catch(a){return console.error("Error reading data directory:",a),[]}}async readDataFile(a){try{let b=await e().promises.readFile(a,"utf-8");return JSON.parse(b)}catch(b){return console.error(`Error reading file ${a}:`,b),[]}}getMetricKey(a,b){return"bond_issuance"===a&&"weekly"===b?"bond_issuance":"bdc_discount"===a&&"discount_to_nav"===b?"bdc_discount":({bond_issuance:"bond_issuance",bdc_discount:"bdc_discount",credit_fund:"credit_fund",bank_provision:"bank_provision"})[a]||`${a}_${b}`}formatMetricName(a,b){return({bond_issuance:"Bond Issuance",bdc_discount:"BDC Discount",credit_fund:"Credit Fund Assets",bank_provision:"Bank Provisions"})[a]||`${a} ${b}`.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}getUnit(a){return({bond_issuance:"currency",bdc_discount:"percent",credit_fund:"currency",bank_provision:"percent"})[a]||"unit"}getStatus(a,b){let c={bond_issuance:{warning:4e9,critical:5e9},bdc_discount:{warning:8,critical:10},credit_fund:{warning:8e10,critical:1e11},bank_provision:{warning:12,critical:15}}[b];return c?a>=c.critical?"critical":a>=c.warning?"warning":"healthy":"healthy"}constructor(){this.dataDir="/Users/turphai/Projects/kiro_aiCrash/data"}}let i=new h},9021:a=>{a.exports=require("fs")}};var b=require("../../../webpack-api-runtime.js");b.C(a);var c=b.X(0,[169],()=>b(b.s=6935));module.exports=c})();