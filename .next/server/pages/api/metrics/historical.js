"use strict";(()=>{var e={};e.id=460,e.ids=[460],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},3529:(e,t,a)=>{a.r(t),a.d(t,{config:()=>l,default:()=>u,routeModule:()=>f});var r={};a.r(r),a.d(r,{default:()=>o});var i=a(1802),n=a(7153),s=a(6249),c=a(233);async function o(e,t){if("GET"!==e.method)return t.status(405).json({message:"Method not allowed"});let a=parseInt(e.query.days)||30,r=new Date;r.setDate(r.getDate()-a);try{let e=await d(a);t.status(200).json({success:!0,data:e,period:`${a} days`,timestamp:new Date().toISOString()})}catch(e){console.error("Error fetching historical data:",e),t.status(500).json({success:!1,error:"Failed to fetch historical data",period:`${a} days`,timestamp:new Date().toISOString()})}}async function d(e){try{let t={};for(let a of["bond_issuance","bdc_discount","credit_fund","bank_provision"]){let r=await c.Y.getHistoricalData(a,e);r.length>0&&(t[a]=r)}return t}catch(e){return console.error("Error getting real historical data:",e),{}}}let u=(0,s.l)(r,"default"),l=(0,s.l)(r,"config"),f=new i.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/metrics/historical",pathname:"/api/metrics/historical",bundlePath:"",filename:""},userland:r})},233:(e,t,a)=>{a.d(t,{Y:()=>o});var r=a(7147),i=a.n(r),n=a(1017),s=a.n(n);class c{async getLatestMetrics(){try{let e=await this.getDataFiles(),t=[];for(let a of e){let e=await this.readDataFile(a);if(e.length>0){let a=e[0],r=this.getMetricKey(a.data_source,a.metric_name),i=0,n=0;if(e.length>1){let t=e[1];i=a.data.value-t.data.value,n=0!==t.data.value?i/t.data.value*100:0}let s=this.getStatus(a.data.value,r),c={key:r,name:this.formatMetricName(a.data_source,a.metric_name),value:a.data.value,unit:this.getUnit(r),change:i,changePercent:n,status:s,lastUpdated:a.timestamp,source:a.data_source,confidence:a.data.confidence,metadata:a.data.metadata};t.push(c)}}return t}catch(e){return console.error("Error reading real data:",e),[]}}async getHistoricalData(e,t){try{let a=await this.getDataFiles(),r=new Date;for(let i of(r.setDate(r.getDate()-t),a)){let t=await this.readDataFile(i);if(t.length>0&&this.getMetricKey(t[0].data_source,t[0].metric_name)===e)return t.filter(e=>new Date(e.timestamp)>=r).map(e=>({timestamp:e.timestamp,value:e.data.value,metadata:e.data.metadata})).sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime())}return[]}catch(e){return console.error("Error reading historical data:",e),[]}}async getDataSources(){try{let e=await this.getDataFiles(),t=new Set;for(let a of e){let e=await this.readDataFile(a);e.length>0&&t.add(e[0].data_source)}return Array.from(t)}catch(e){return console.error("Error reading data sources:",e),[]}}async getDataFiles(){try{return(await i().promises.readdir(this.dataDir)).filter(e=>e.endsWith(".json")).filter(e=>!e.includes("dashboard_alerts")).filter(e=>!e.includes("test_")).filter(e=>!e.includes("health_check_")).filter(e=>!e.includes("comprehensive_test_")).map(e=>s().join(this.dataDir,e))}catch(e){return console.error("Error reading data directory:",e),[]}}async readDataFile(e){try{let t=await i().promises.readFile(e,"utf-8");return JSON.parse(t)}catch(t){return console.error(`Error reading file ${e}:`,t),[]}}getMetricKey(e,t){return"bond_issuance"===e&&"weekly"===t?"bond_issuance":"bdc_discount"===e&&"discount_to_nav"===t?"bdc_discount":({bond_issuance:"bond_issuance",bdc_discount:"bdc_discount",credit_fund:"credit_fund",bank_provision:"bank_provision"})[e]||`${e}_${t}`}formatMetricName(e,t){return({bond_issuance:"Bond Issuance",bdc_discount:"BDC Discount",credit_fund:"Credit Fund Assets",bank_provision:"Bank Provisions"})[e]||`${e} ${t}`.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}getUnit(e){return({bond_issuance:"currency",bdc_discount:"percent",credit_fund:"currency",bank_provision:"percent"})[e]||"unit"}getStatus(e,t){let a={bond_issuance:{warning:4e9,critical:5e9},bdc_discount:{warning:8,critical:10},credit_fund:{warning:8e10,critical:1e11},bank_provision:{warning:12,critical:15}}[t];return a?e>=a.critical?"critical":e>=a.warning?"warning":"healthy":"healthy"}constructor(){this.dataDir=s().join(process.cwd(),"data")}}let o=new c},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=3529);module.exports=a})();