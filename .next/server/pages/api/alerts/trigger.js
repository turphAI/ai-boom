"use strict";(()=>{var e={};e.id=301,e.ids=[301],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},6181:(e,t,r)=>{r.r(t),r.d(t,{config:()=>l,default:()=>c,routeModule:()=>u});var a={};r.r(a),r.d(a,{default:()=>d});var s=r(1802),i=r(7153),n=r(6249),o=r(3897);async function d(e,t){if("GET"===e.method)try{let e=await o.e.evaluateAlerts();t.status(200).json({success:!0,triggers:e,timestamp:new Date().toISOString(),summary:{total:e.length,critical:e.filter(e=>"critical"===e.severity).length,high:e.filter(e=>"high"===e.severity).length,medium:e.filter(e=>"medium"===e.severity).length,low:e.filter(e=>"low"===e.severity).length}})}catch(e){console.error("Error triggering alerts:",e),t.status(500).json({success:!1,message:"Failed to trigger alerts",error:e instanceof Error?e.message:"Unknown error"})}else if("POST"===e.method)try{let{action:r,thresholdId:a,threshold:s}=e.body;switch(r){case"update_threshold":await o.e.updateThreshold(s),t.status(200).json({success:!0,message:"Threshold updated successfully"});break;case"delete_threshold":await o.e.deleteThreshold(a),t.status(200).json({success:!0,message:"Threshold deleted successfully"});break;default:t.status(400).json({success:!1,message:"Invalid action"})}}catch(e){console.error("Error managing thresholds:",e),t.status(500).json({success:!1,message:"Failed to manage thresholds",error:e instanceof Error?e.message:"Unknown error"})}else t.status(405).json({message:"Method not allowed"})}let c=(0,n.l)(a,"default"),l=(0,n.l)(a,"config"),u=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/alerts/trigger",pathname:"/api/alerts/trigger",bundlePath:"",filename:""},userland:a})},233:(e,t,r)=>{r.d(t,{Y:()=>d});var a=r(7147),s=r.n(a),i=r(1017),n=r.n(i);class o{async getLatestMetrics(){try{let e=await this.getDataFiles(),t=[];for(let r of e){let e=await this.readDataFile(r);if(e.length>0){let r=e[0],a=this.getMetricKey(r.data_source,r.metric_name),s=0,i=0;if(e.length>1){let t=e[1];s=r.data.value-t.data.value,i=0!==t.data.value?s/t.data.value*100:0}let n=this.getStatus(r.data.value,a),o={key:a,name:this.formatMetricName(r.data_source,r.metric_name),value:r.data.value,unit:this.getUnit(a),change:s,changePercent:i,status:n,lastUpdated:r.timestamp,source:r.data_source,confidence:r.data.confidence,metadata:r.data.metadata};t.push(o)}}return t}catch(e){return console.error("Error reading real data:",e),[]}}async getHistoricalData(e,t){try{let r=await this.getDataFiles(),a=new Date;for(let s of(a.setDate(a.getDate()-t),r)){let t=await this.readDataFile(s);if(t.length>0&&this.getMetricKey(t[0].data_source,t[0].metric_name)===e)return t.filter(e=>new Date(e.timestamp)>=a).map(e=>({timestamp:e.timestamp,value:e.data.value,metadata:e.data.metadata})).sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime())}return[]}catch(e){return console.error("Error reading historical data:",e),[]}}async getDataSources(){try{let e=await this.getDataFiles(),t=new Set;for(let r of e){let e=await this.readDataFile(r);e.length>0&&t.add(e[0].data_source)}return Array.from(t)}catch(e){return console.error("Error reading data sources:",e),[]}}async getDataFiles(){try{return(await s().promises.readdir(this.dataDir)).filter(e=>e.endsWith(".json")).filter(e=>!e.includes("dashboard_alerts")).filter(e=>!e.includes("test_")).filter(e=>!e.includes("health_check_")).filter(e=>!e.includes("comprehensive_test_")).map(e=>n().join(this.dataDir,e))}catch(e){return console.error("Error reading data directory:",e),[]}}async readDataFile(e){try{let t=await s().promises.readFile(e,"utf-8");return JSON.parse(t)}catch(t){return console.error(`Error reading file ${e}:`,t),[]}}getMetricKey(e,t){return"bond_issuance"===e&&"weekly"===t?"bond_issuance":"bdc_discount"===e&&"discount_to_nav"===t?"bdc_discount":({bond_issuance:"bond_issuance",bdc_discount:"bdc_discount",credit_fund:"credit_fund",bank_provision:"bank_provision"})[e]||`${e}_${t}`}formatMetricName(e,t){return({bond_issuance:"Bond Issuance",bdc_discount:"BDC Discount",credit_fund:"Credit Fund Assets",bank_provision:"Bank Provisions"})[e]||`${e} ${t}`.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}getUnit(e){return({bond_issuance:"currency",bdc_discount:"percent",credit_fund:"currency",bank_provision:"percent"})[e]||"unit"}getStatus(e,t){let r={bond_issuance:{warning:4e9,critical:5e9},bdc_discount:{warning:8,critical:10},credit_fund:{warning:8e10,critical:1e11},bank_provision:{warning:12,critical:15}}[t];return r?e>=r.critical?"critical":e>=r.warning?"warning":"healthy":"healthy"}constructor(){this.dataDir=n().join(process.cwd(),"data")}}let d=new o},3897:(e,t,r)=>{r.d(t,{e:()=>i});var a=r(233);class s{async evaluateAlerts(){try{let e=await a.Y.getLatestMetrics(),t=[];for(let r of e)for(let e of this.thresholds.filter(e=>e.metricKey===r.id&&e.enabled))if(this.evaluateThreshold(r,e)){let a={id:`${e.id}_${Date.now()}`,thresholdId:e.id,metricKey:r.id,currentValue:r.value,thresholdValue:e.thresholdValue,severity:e.severity,message:this.generateAlertMessage(r,e),timestamp:new Date().toISOString(),triggered:!0};t.push(a)}return t}catch(e){return console.error("Error evaluating alerts:",e),[]}}evaluateThreshold(e,t){let{value:r}=e,{thresholdValue:a,comparisonOperator:s}=t;switch(s){case"gt":return r>a;case"lt":return r<a;case"gte":return r>=a;case"lte":return r<=a;case"eq":return r===a;default:return!1}}generateAlertMessage(e,t){let{name:r,value:a,unit:s,changePercent:i}=e,{thresholdValue:n,severity:o,description:d}=t,c=(e,t)=>"currency"===t?`$${(e/1e9).toFixed(1)}B`:"percent"===t?`${(100*e).toFixed(1)}%`:e.toLocaleString(),l=c(a,s),u=c(n,s),h=0!==i?` (${i>0?"+":""}${i.toFixed(1)}% from previous)`:"";return`ðŸš¨ ${o.toUpperCase()} ALERT: ${r}${h}

Current: ${l}
Threshold: ${u}
Status: ${d}

Time: ${new Date().toLocaleString()}`}async getThresholds(){return this.thresholds}async updateThreshold(e){let t=this.thresholds.findIndex(t=>t.id===e.id);-1!==t?this.thresholds[t]=e:this.thresholds.push(e)}async deleteThreshold(e){this.thresholds=this.thresholds.filter(t=>t.id!==e)}constructor(){this.thresholds=[{id:"bond_issuance_warning",metricKey:"bond_issuance",thresholdType:"absolute",thresholdValue:4e9,comparisonOperator:"gte",severity:"medium",enabled:!0,description:"Bond issuance exceeds $4B warning threshold"},{id:"bond_issuance_critical",metricKey:"bond_issuance",thresholdType:"absolute",thresholdValue:5e9,comparisonOperator:"gte",severity:"critical",enabled:!0,description:"Bond issuance exceeds $5B critical threshold"},{id:"bdc_discount_warning",metricKey:"bdc_discount",thresholdType:"absolute",thresholdValue:8,comparisonOperator:"gte",severity:"medium",enabled:!0,description:"BDC discount exceeds 8% warning threshold"},{id:"bdc_discount_critical",metricKey:"bdc_discount",thresholdType:"absolute",thresholdValue:10,comparisonOperator:"gte",severity:"critical",enabled:!0,description:"BDC discount exceeds 10% critical threshold"},{id:"credit_fund_warning",metricKey:"credit_fund",thresholdType:"absolute",thresholdValue:8e10,comparisonOperator:"gte",severity:"medium",enabled:!0,description:"Credit fund assets exceed $80B warning threshold"},{id:"credit_fund_critical",metricKey:"credit_fund",thresholdType:"absolute",thresholdValue:1e11,comparisonOperator:"gte",severity:"critical",enabled:!0,description:"Credit fund assets exceed $100B critical threshold"},{id:"bank_provision_warning",metricKey:"bank_provision",thresholdType:"absolute",thresholdValue:12,comparisonOperator:"gte",severity:"medium",enabled:!0,description:"Bank provisions exceed 12% warning threshold"},{id:"bank_provision_critical",metricKey:"bank_provision",thresholdType:"absolute",thresholdValue:15,comparisonOperator:"gte",severity:"critical",enabled:!0,description:"Bank provisions exceed 15% critical threshold"}]}}let i=new s},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=6181);module.exports=r})();