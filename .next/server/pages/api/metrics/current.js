"use strict";(()=>{var a={};a.id=268,a.ids=[268],a.modules={3873:a=>{a.exports=require("path")},5200:(a,b,c)=>{c.r(b),c.d(b,{config:()=>n,default:()=>m,handler:()=>p});var d={};c.r(d),c.d(d,{default:()=>j});var e=c(9046),f=c(8667),g=c(3480),h=c(6435),i=c(9010);async function j(a,b){if("GET"!==a.method)return b.status(405).json({message:"Method not allowed"});try{let a=await i.K.getLatestMetrics();if(0===a.length)return b.status(404).json({success:!1,error:"No real data available. Please run the scrapers to collect data.",timestamp:new Date().toISOString()});b.status(200).json({success:!0,metrics:a,timestamp:new Date().toISOString(),note:"Using real scraper data"})}catch(a){console.error("Metrics error:",a),b.status(500).json({success:!1,error:"Failed to fetch real data",timestamp:new Date().toISOString()})}}var k=c(8112),l=c(8766);let m=(0,h.M)(d,"default"),n=(0,h.M)(d,"config"),o=new g.PagesAPIRouteModule({definition:{kind:f.A.PAGES_API,page:"/api/metrics/current",pathname:"/api/metrics/current",bundlePath:"",filename:""},userland:d,distDir:".next",projectDir:""});async function p(a,b,c){let d=await o.prepare(a,b,{srcPage:"/api/metrics/current"});if(!d){b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve());return}let{query:f,params:g,prerenderManifest:h}=d;try{let c=a.method||"GET",d=(0,k.getTracer)(),e=d.getActiveScopeSpan(),i=o.instrumentationOnRequestError.bind(o),j=async e=>o.render(a,b,{query:{...f,...g},params:g,allowedRevalidateHeaderKeys:void 0,multiZoneDraftMode:!0,trustHostHeader:void 0,previewProps:h.preview,propagateError:!1,dev:o.isDev,page:"/api/metrics/current",projectDir:"",onError:(...b)=>i(a,...b)}).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let f=d.getRootSpanAttributes();if(!f)return;if(f.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${f.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let g=f.get("next.route");if(g){let a=`${c} ${g}`;e.setAttributes({"next.route":g,"http.route":g,"next.span_name":a}),e.updateName(a)}else e.updateName(`${c} ${a.url}`)});e?await j(e):await d.withPropagatedContext(a.headers,()=>d.trace(l.BaseServerSpan.handleRequest,{spanName:`${c} ${a.url}`,kind:k.SpanKind.SERVER,attributes:{"http.method":c,"http.target":a.url}},j))}catch(a){if(o.isDev)throw a;(0,e.sendError)(b,500,"Internal Server Error")}finally{null==c.waitUntil||c.waitUntil.call(c,Promise.resolve())}}},5600:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9010:(a,b,c)=>{c.d(b,{K:()=>i});var d=c(9021),e=c.n(d),f=c(3873),g=c.n(f);class h{async getLatestMetrics(){try{let a=await this.getDataFiles(),b=[];for(let c of a){let a=await this.readDataFile(c);if(a.length>0){let c=a[0],d=this.getMetricKey(c.data_source,c.metric_name),e=0,f=0;if(a.length>1){let b=a[1];e=c.data.value-b.data.value,f=0!==b.data.value?e/b.data.value*100:0}let g=this.getStatus(c.data.value,d),h={key:d,name:this.formatMetricName(c.data_source,c.metric_name),value:c.data.value,unit:this.getUnit(d),change:e,changePercent:f,status:g,lastUpdated:c.timestamp,source:c.data_source,confidence:c.data.confidence,metadata:c.data.metadata};b.push(h)}}return b}catch(a){return console.error("Error reading real data:",a),[]}}async getHistoricalData(a,b){try{let c=await this.getDataFiles(),d=new Date;for(let e of(d.setDate(d.getDate()-b),c)){let b=await this.readDataFile(e);if(b.length>0&&this.getMetricKey(b[0].data_source,b[0].metric_name)===a)return b.filter(a=>new Date(a.timestamp)>=d).map(a=>({timestamp:a.timestamp,value:a.data.value,metadata:a.data.metadata})).sort((a,b)=>new Date(a.timestamp).getTime()-new Date(b.timestamp).getTime())}return[]}catch(a){return console.error("Error reading historical data:",a),[]}}async getDataSources(){try{let a=await this.getDataFiles(),b=new Set;for(let c of a){let a=await this.readDataFile(c);a.length>0&&b.add(a[0].data_source)}return Array.from(b)}catch(a){return console.error("Error reading data sources:",a),[]}}async getDataFiles(){try{return(await e().promises.readdir(this.dataDir)).filter(a=>a.endsWith(".json")).filter(a=>!a.includes("dashboard_alerts")).filter(a=>!a.includes("test_")).filter(a=>!a.includes("health_check_")).filter(a=>!a.includes("comprehensive_test_")).map(a=>g().join(this.dataDir,a))}catch(a){return console.error("Error reading data directory:",a),[]}}async readDataFile(a){try{let b=await e().promises.readFile(a,"utf-8");return JSON.parse(b)}catch(b){return console.error(`Error reading file ${a}:`,b),[]}}getMetricKey(a,b){return"bond_issuance"===a&&"weekly"===b?"bond_issuance":"bdc_discount"===a&&"discount_to_nav"===b?"bdc_discount":({bond_issuance:"bond_issuance",bdc_discount:"bdc_discount",credit_fund:"credit_fund",bank_provision:"bank_provision"})[a]||`${a}_${b}`}formatMetricName(a,b){return({bond_issuance:"Bond Issuance",bdc_discount:"BDC Discount",credit_fund:"Credit Fund Assets",bank_provision:"Bank Provisions"})[a]||`${a} ${b}`.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}getUnit(a){return({bond_issuance:"currency",bdc_discount:"percent",credit_fund:"currency",bank_provision:"percent"})[a]||"unit"}getStatus(a,b){let c={bond_issuance:{warning:4e9,critical:5e9},bdc_discount:{warning:8,critical:10},credit_fund:{warning:8e10,critical:1e11},bank_provision:{warning:12,critical:15}}[b];return c?a>=c.critical?"critical":a>=c.warning?"warning":"healthy":"healthy"}constructor(){this.dataDir="/Users/turphai/Projects/kiro_aiCrash/data"}}let i=new h},9021:a=>{a.exports=require("fs")}};var b=require("../../../webpack-api-runtime.js");b.C(a);var c=b.X(0,[169],()=>b(b.s=5200));module.exports=c})();