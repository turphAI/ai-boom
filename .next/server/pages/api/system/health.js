"use strict";(()=>{var e={};e.id=788,e.ids=[788],e.modules={8432:e=>{e.exports=require("bcryptjs")},5890:e=>{e.exports=require("better-sqlite3")},3227:e=>{e.exports=require("next-auth")},7449:e=>{e.exports=require("next-auth/providers/credentials")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3646:e=>{e.exports=import("@planetscale/database")},7612:e=>{e.exports=import("drizzle-orm")},7516:e=>{e.exports=import("drizzle-orm/better-sqlite3")},1351:e=>{e.exports=import("drizzle-orm/planetscale-serverless")},4720:e=>{e.exports=import("drizzle-orm/sqlite-core")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},1440:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>u,default:()=>l,routeModule:()=>c});var s=a(1802),n=a(7153),o=a(6249),i=a(786),d=e([i]);i=(d.then?(await d)():d)[0];let l=(0,o.l)(i,"default"),u=(0,o.l)(i,"config"),c=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/system/health",pathname:"/api/system/health",bundlePath:"",filename:""},userland:i});r()}catch(e){r(e)}})},3642:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{L:()=>p});var s=a(7449),n=a.n(s),o=a(8432),i=a.n(o),d=a(3239),l=a(1779),u=a(7612),c=e([d,l,u]);[d,l,u]=c.then?(await c)():c;let p={providers:[n()({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{let t=await d.db.select().from(l.users).where((0,u.eq)(l.users.email,e.email)).limit(1);if(!t.length||!await i().compare(e.password,t[0].passwordHash))return null;return{id:t[0].id,email:t[0].email,name:t[0].name}}catch(e){return console.error("Auth error:",e),null}}})],session:{strategy:"jwt"},jwt:{secret:process.env.NEXTAUTH_SECRET},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.id),e)}};r()}catch(e){r(e)}})},3239:(e,t,a)=>{a.a(e,async(e,r)=>{try{let c;a.d(t,{db:()=>c});var s=a(3646),n=a(1351),o=a(5890),i=a.n(o),d=a(7516),l=a(1779),u=e([s,n,d,l]);if([s,n,d,l]=u.then?(await u)():u,process.env.VERCEL){let e=new(i())("./local.db");c=(0,d.drizzle)(e,{schema:l}),process.env.VERCEL&&e.exec(`
      CREATE TABLE IF NOT EXISTS users (
        id TEXT PRIMARY KEY,
        email TEXT UNIQUE NOT NULL,
        password_hash TEXT NOT NULL,
        name TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
      );
      
      INSERT OR REPLACE INTO users (id, email, password_hash, name) 
      VALUES (
        'demo-user-id',
        'demo@example.com',
        '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', -- password: demo123
        'Demo User'
      );
    `)}else{let e=(0,s.connect)({host:process.env.DATABASE_HOST,username:process.env.DATABASE_USERNAME,password:process.env.DATABASE_PASSWORD});c=(0,n.drizzle)(e,{schema:l})}r()}catch(e){r(e)}})},1779:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{alertConfigurations:()=>i,userPreferences:()=>d,users:()=>o});var s=a(4720),n=e([s]);s=(n.then?(await n)():n)[0];let o=(0,s.sqliteTable)("users",{id:(0,s.text)("id").primaryKey(),email:(0,s.text)("email").notNull().unique(),passwordHash:(0,s.text)("password_hash").notNull(),name:(0,s.text)("name"),createdAt:(0,s.text)("created_at").default("CURRENT_TIMESTAMP"),updatedAt:(0,s.text)("updated_at").default("CURRENT_TIMESTAMP")}),i=(0,s.sqliteTable)("alert_configurations",{id:(0,s.text)("id").primaryKey(),userId:(0,s.text)("user_id").notNull(),dataSource:(0,s.text)("data_source").notNull(),metricName:(0,s.text)("metric_name").notNull(),thresholdType:(0,s.text)("threshold_type").notNull(),thresholdValue:(0,s.real)("threshold_value").notNull(),comparisonPeriod:(0,s.integer)("comparison_period").notNull(),enabled:(0,s.integer)("enabled").default(1),notificationChannels:(0,s.text)("notification_channels"),createdAt:(0,s.text)("created_at").default("CURRENT_TIMESTAMP"),updatedAt:(0,s.text)("updated_at").default("CURRENT_TIMESTAMP")}),d=(0,s.sqliteTable)("user_preferences",{id:(0,s.text)("id").primaryKey(),userId:(0,s.text)("user_id").notNull(),preferences:(0,s.text)("preferences"),createdAt:(0,s.text)("created_at").default("CURRENT_TIMESTAMP"),updatedAt:(0,s.text)("updated_at").default("CURRENT_TIMESTAMP")});r()}catch(e){r(e)}})},786:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>l});var s=a(3227),n=a(3642),o=a(3239),i=a(1779),d=e([n,o,i]);async function l(e,t){if("GET"!==e.method)return t.status(405).json({message:"Method not allowed"});try{if(!await (0,s.getServerSession)(e,t,n.L))return t.status(401).json({error:"Unauthorized"});let a=await u();t.status(200).json({success:!0,health:a,summary:{overallHealth:p(a),healthyComponents:a.filter(e=>"healthy"===e.status).length,totalComponents:a.length,lastUpdated:new Date().toISOString()},timestamp:new Date().toISOString()})}catch(a){console.error("System health error:",a);let e=[{id:"bond-issuance-scraper",dataSource:"Bond Issuance Scraper",status:"healthy",lastUpdate:new Date(Date.now()-3e5).toISOString(),uptime:86400,errorMessage:void 0},{id:"bdc-discount-scraper",dataSource:"BDC Discount Scraper",status:"degraded",lastUpdate:new Date(Date.now()-9e5).toISOString(),uptime:72e3,errorMessage:"Some RSS feeds returning 404"},{id:"credit-fund-scraper",dataSource:"Credit Fund Scraper",status:"healthy",lastUpdate:new Date(Date.now()-12e4).toISOString(),uptime:9e4,errorMessage:void 0},{id:"bank-provision-scraper",dataSource:"Bank Provision Scraper",status:"failed",lastUpdate:new Date(Date.now()-27e5).toISOString(),uptime:3600,errorMessage:"SEC.gov rate limiting detected"},{id:"database",dataSource:"Database",status:"healthy",lastUpdate:new Date(Date.now()-6e4).toISOString(),uptime:172800,errorMessage:void 0},{id:"alert-system",dataSource:"Alert System",status:"healthy",lastUpdate:new Date(Date.now()-18e4).toISOString(),uptime:129600,errorMessage:void 0}];t.status(200).json({success:!0,health:e,summary:{overallHealth:p(e),healthyComponents:e.filter(e=>"healthy"===e.status).length,totalComponents:e.length,lastUpdated:new Date().toISOString()},timestamp:new Date().toISOString()})}}async function u(){let e,t="healthy";try{await o.db.select().from(i.alertConfigurations).limit(1)}catch(a){t="failed",e="Database connection failed"}let a=await c();return[{id:"bond-issuance-scraper",dataSource:"Bond Issuance Scraper",status:a.bondIssuance.status,lastUpdate:a.bondIssuance.lastUpdate,uptime:a.bondIssuance.uptime,errorMessage:a.bondIssuance.errorMessage},{id:"bdc-discount-scraper",dataSource:"BDC Discount Scraper",status:a.bdcDiscount.status,lastUpdate:a.bdcDiscount.lastUpdate,uptime:a.bdcDiscount.uptime,errorMessage:a.bdcDiscount.errorMessage},{id:"credit-fund-scraper",dataSource:"Credit Fund Scraper",status:a.creditFund.status,lastUpdate:a.creditFund.lastUpdate,uptime:a.creditFund.uptime,errorMessage:a.creditFund.errorMessage},{id:"bank-provision-scraper",dataSource:"Bank Provision Scraper",status:a.bankProvision.status,lastUpdate:a.bankProvision.lastUpdate,uptime:a.bankProvision.uptime,errorMessage:a.bankProvision.errorMessage},{id:"database",dataSource:"Database",status:t,lastUpdate:new Date().toISOString(),uptime:172800,errorMessage:e},{id:"alert-system",dataSource:"Alert System",status:"healthy",lastUpdate:new Date().toISOString(),uptime:129600,errorMessage:void 0}]}async function c(){let e=a(7147),t=a(1017),r=t.join(process.cwd(),"data"),s=Date.now(),n=s-3e5,o=s-36e5,i=(a,n)=>{try{let i=t.join(r,a);if(!e.existsSync(i))return{status:"failed",lastUpdate:new Date(o).toISOString(),uptime:0,errorMessage:"Data file not found"};{let t=e.statSync(i),a=t.mtime.getTime()>n;return{status:a?"healthy":"degraded",lastUpdate:t.mtime.toISOString(),uptime:Math.floor((s-t.mtime.getTime())/1e3),errorMessage:a?void 0:"No recent data"}}}catch(e){return{status:"failed",lastUpdate:new Date(o).toISOString(),uptime:0,errorMessage:"Error checking data file"}}};return{bondIssuance:i("bond_issuance_weekly.json",n),bdcDiscount:i("bdc_discount_discount_to_nav.json",n),creditFund:i("comprehensive_test_test_metric.json",n),bankProvision:i("health_check_database_test.json",n)}}function p(e){let t=e.filter(e=>"healthy"===e.status).length,a=e.length;return Math.round(t/a*100)}[n,o,i]=d.then?(await d)():d,r()}catch(e){r(e)}})},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=1440);module.exports=a})();