"use strict";(()=>{var e={};e.id=286,e.ids=[286],e.modules={8432:e=>{e.exports=require("bcryptjs")},5890:e=>{e.exports=require("better-sqlite3")},3227:e=>{e.exports=require("next-auth")},7449:e=>{e.exports=require("next-auth/providers/credentials")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3646:e=>{e.exports=import("@planetscale/database")},7612:e=>{e.exports=import("drizzle-orm")},7516:e=>{e.exports=import("drizzle-orm/better-sqlite3")},9089:e=>{e.exports=import("drizzle-orm/mysql-core")},1351:e=>{e.exports=import("drizzle-orm/planetscale-serverless")},9926:e=>{e.exports=import("zod")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},9329:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>c,default:()=>d,routeModule:()=>u});var s=t(1802),n=t(7153),o=t(6249),i=t(6130),l=e([i]);i=(l.then?(await l)():l)[0];let d=(0,o.l)(i,"default"),c=(0,o.l)(i,"config"),u=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/user/preferences",pathname:"/api/user/preferences",bundlePath:"",filename:""},userland:i});a()}catch(e){a(e)}})},3642:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{L:()=>p});var s=t(7449),n=t.n(s),o=t(8432),i=t.n(o),l=t(3239),d=t(1779),c=t(7612),u=e([l,d,c]);[l,d,c]=u.then?(await u)():u;let p={providers:[n()({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{let r=await l.db.select().from(d.users).where((0,c.eq)(d.users.email,e.email)).limit(1);if(!r.length||!await i().compare(e.password,r[0].passwordHash))return null;return{id:r[0].id,email:r[0].email,name:r[0].name}}catch(e){return console.error("Auth error:",e),null}}})],session:{strategy:"jwt"},jwt:{secret:process.env.NEXTAUTH_SECRET},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id),e),session:async({session:e,token:r})=>(r&&(e.user.id=r.id),e)}};a()}catch(e){a(e)}})},3239:(e,r,t)=>{t.a(e,async(e,a)=>{try{let d;t.d(r,{db:()=>d});var s=t(3646),n=t(1351);t(5890);var o=t(7516),i=t(1779),l=e([s,n,o,i]);[s,n,o,i]=l.then?(await l)():l;{let e=(0,s.connect)({host:process.env.DATABASE_HOST,username:process.env.DATABASE_USERNAME,password:process.env.DATABASE_PASSWORD});d=(0,n.drizzle)(e,{schema:i})}a()}catch(e){a(e)}})},1779:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{alertConfigurations:()=>i,userPreferences:()=>l,users:()=>o});var s=t(9089),n=e([s]);s=(n.then?(await n)():n)[0];let o=(0,s.mysqlTable)("users",{id:(0,s.varchar)("id",{length:255}).primaryKey(),email:(0,s.varchar)("email",{length:255}).notNull().unique(),passwordHash:(0,s.varchar)("password_hash",{length:255}).notNull(),name:(0,s.varchar)("name",{length:255}),createdAt:(0,s.timestamp)("created_at").defaultNow(),updatedAt:(0,s.timestamp)("updated_at").defaultNow().onUpdateNow()}),i=(0,s.mysqlTable)("alert_configurations",{id:(0,s.varchar)("id",{length:255}).primaryKey(),userId:(0,s.varchar)("user_id",{length:255}).notNull(),dataSource:(0,s.varchar)("data_source",{length:100}).notNull(),metricName:(0,s.varchar)("metric_name",{length:100}).notNull(),thresholdType:(0,s.varchar)("threshold_type",{length:50}).notNull(),thresholdValue:(0,s.decimal)("threshold_value",{precision:15,scale:2}).notNull(),comparisonPeriod:(0,s.int)("comparison_period").notNull(),enabled:(0,s.boolean)("enabled").default(!0),notificationChannels:(0,s.json)("notification_channels").$type(),createdAt:(0,s.timestamp)("created_at").defaultNow(),updatedAt:(0,s.timestamp)("updated_at").defaultNow().onUpdateNow()}),l=(0,s.mysqlTable)("user_preferences",{id:(0,s.varchar)("id",{length:255}).primaryKey(),userId:(0,s.varchar)("user_id",{length:255}).notNull(),preferences:(0,s.json)("preferences").$type(),createdAt:(0,s.timestamp)("created_at").defaultNow(),updatedAt:(0,s.timestamp)("updated_at").defaultNow().onUpdateNow()});a()}catch(e){a(e)}})},6130:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{default:()=>u});var s=t(3227),n=t(3642),o=t(3239),i=t(1779),l=t(7612),d=t(9926),c=e([n,o,i,l,d]);[n,o,i,l,d]=c.then?(await c)():c;let h=d.z.object({theme:d.z.enum(["light","dark"]).optional(),timezone:d.z.string().optional(),defaultChartPeriod:d.z.number().min(1).max(365).optional(),emailNotifications:d.z.boolean().optional(),slackWebhook:d.z.string().url().optional(),telegramBotToken:d.z.string().optional(),telegramChatId:d.z.string().optional()});async function u(e,r){try{let t=await (0,s.getServerSession)(e,r,n.L);if(!t)return r.status(401).json({error:"Unauthorized"});let a=t.user.id;switch(e.method){case"GET":return await p(e,r,a);case"PUT":return await m(e,r,a);default:return r.status(405).json({error:"Method not allowed"})}}catch(e){console.error("User preferences error:",e),r.status(500).json({error:"Internal server error"})}}async function p(e,r,t){let a=await o.db.select().from(i.userPreferences).where((0,l.eq)(i.userPreferences.userId,t)).limit(1);if(0===a.length)return r.status(200).json({preferences:{theme:"light",timezone:"UTC",defaultChartPeriod:30,emailNotifications:!0}});r.status(200).json({preferences:a[0].preferences})}async function m(e,r,t){let a=h.parse(e.body),s=await o.db.select().from(i.userPreferences).where((0,l.eq)(i.userPreferences.userId,t)).limit(1);if(0===s.length){let e=crypto.randomUUID();await o.db.insert(i.userPreferences).values({id:e,userId:t,preferences:a})}else{let e={...s[0].preferences||{},...a};await o.db.update(i.userPreferences).set({preferences:e}).where((0,l.eq)(i.userPreferences.userId,t))}let n=await o.db.select().from(i.userPreferences).where((0,l.eq)(i.userPreferences.userId,t)).limit(1);r.status(200).json({preferences:n[0].preferences})}a()}catch(e){a(e)}})},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=9329);module.exports=t})();